<!-- Loading overlay -->
@if (isLoading) {
  <div class="loading-overlay">
    <div class="loading-spinner"></div>
  </div>
}

<div class="container">
  @if (selectedLeague) {
    <section class="slide-in">
      <!-- Season selector with league logo -->
      <div class="season-selector">
        <div class="season-header">
          <h2 class="section-title">{{ selectedLeague.league.name }}</h2>
          <div class="logo-selector-row">
            <img 
              class="league-logo-season" 
              [src]="images.getRouteImageLeagueSm(selectedLeague.league.id)"
              [alt]="selectedLeague.league.name + ' logo'"
              (click)="goToLeagueSelector()"
              tabindex="0"
              role="button"
              [attr.aria-label]="'Go back to league selector'">
            <div class="season-info">
              <mat-form-field appearance="outline">
                <mat-label>Select Season</mat-label>
                <mat-select 
                  [(ngModel)]="selectedSeason" 
                  (selectionChange)="getTeamsBySeason(selectedSeason)"
                  aria-label="Select season">
                  @for (season of seasonsFiltered; track season.id) {
                    <mat-option [value]="season">{{ season.text }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            </div>
          </div>
        </div>
      </div>

      <!-- Teams and Matches Container -->
      <div class="teams-matches-container">
        <!-- Teams grid -->
        @if (showTeams.length > 0) {
          <div class="teams-section">
            <h2 class="section-title">Teams</h2>
            <div class="teams-grid">
              @for (team of showTeams; track team.team.id) {
                <a 
                  class="team-card"
                  (click)="selectTeam(team)" 
                  routerLink="/app/team" 
                  [queryParams]="{id: team.team.id}" 
                  routerLinkActive="active" 
                  ariaCurrentWhenActive="page"
                  [attr.aria-label]="'View ' + team.team.name + ' team details'">
                  <img 
                    class="team-logo" 
                    [src]="images.getRouteImageTeam(team.team.id)"
                    [alt]="team.team.name + ' logo'">
                  <p class="team-name">{{ team.team.name }}</p>
                </a>
              }
            </div>

            <!-- Show all teams button -->
            @if (teams.length > 24 && showTeams.length === 24) {
              <button 
                class="show-all-btn"
                (click)="showAllTeams()"
                aria-label="Show all teams">
                <ng-icon name="jamPlus"></ng-icon>
                Show All Teams ({{ teams.length }})
              </button>
            }
          </div>
        }

        <!-- Matches section -->
        @if (groupedRealMatches.length > 0 || isLoadingMatches) {
          <div class="matches-section">
            <h2 class="section-title">Matches</h2>
            
            @if (!isLoadingMatches && groupedRealMatches.length > 0) {
              <!-- Matchday selector -->
              <div class="round-selector">
                <button 
                  class="round-nav-btn"
                  (click)="changeMatchday(-1)"
                  [disabled]="selectedMatchday <= 0"
                  aria-label="Previous matchday">
                  <span>&laquo;</span>
                </button>
                
                <mat-form-field appearance="outline">
                  <mat-label>Matchday</mat-label>
                  <mat-select 
                    [(ngModel)]="selectedMatchday"
                    (selectionChange)="onMatchdayChange(selectedMatchday)"
                    aria-label="Select matchday">
                    @for (matchday of groupedRealMatches; track $index) {
                      <mat-option [value]="$index">
                        {{ parseRoundName(groupedRealMatches[$index][0].league.round) }}
                      </mat-option>
                    }
                  </mat-select>
                </mat-form-field>
                
                <button 
                  class="round-nav-btn"
                  (click)="changeMatchday(1)"
                  [disabled]="selectedMatchday >= groupedRealMatches.length - 1"
                  aria-label="Next matchday">
                  <span>&raquo;</span>
                </button>
              </div>
            }

            @if (isLoadingMatches) {
              <!-- Skeleton matchday selector -->
              <div class="round-selector">
                <div class="skeleton-nav-btn"></div>
                <div class="skeleton-select"></div>
                <div class="skeleton-nav-btn"></div>
              </div>

              <!-- Skeleton matches grid -->
              <div class="matches-grid">
                @for (item of [1,2,3,4,5,6]; track item) {
                  <div class="match-card-wrapper">
                    <div class="match-skeleton-card">
                      <div class="skeleton-match-content">
                        <div class="skeleton-team">
                          <div class="skeleton-team-logo"></div>
                          <div class="skeleton-team-name"></div>
                        </div>
                        <div class="skeleton-score">
                          <div class="skeleton-score-value"></div>
                        </div>
                        <div class="skeleton-team">
                          <div class="skeleton-team-logo"></div>
                          <div class="skeleton-team-name"></div>
                        </div>
                      </div>
                    </div>
                  </div>
                }
              </div>
            } @else if (groupedRealMatches.length > 0) {
              <!-- Matches grid -->
              <div class="matches-grid">
                @for (match of showMatches; track match.fixture.id) {
                  <div class="match-card-wrapper">
                    <app-real-match-card 
                      [match]="matchParser.realMatchToMatch(match, findRealMatchInMatches(match.fixture.id))"
                      [watched]="findRealMatchInMatches(match.fixture.id) !== undefined"
                      [locations]="locations"
                      [size]="'md'">
                    </app-real-match-card>
                  </div>
                }
              </div>

              <!-- Show more matches button -->
              @if (hasMoreMatches()) {
                <button 
                  class="show-all-btn"
                  (click)="showMoreMatches()"
                  aria-label="Show more matches">
                  <ng-icon name="jamPlus"></ng-icon>
                  Show More Matches ({{ groupedRealMatches[selectedMatchday].length - showMatches.length }} remaining)
                </button>
              }
            }
          </div>
        }
      </div>

      <!-- Empty matches state -->
      @if (groupedRealMatches.length === 0 && !isLoadingMatches) {
        <div class="empty-state">
          <div class="empty-state-icon">âš½</div>
          <h2 class="empty-state-title">No Matches Available</h2>
          <p class="empty-state-description">There are no matches scheduled for this league and season.</p>
        </div>
      }
    </section>
  }
</div> 