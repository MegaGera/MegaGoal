@if (isLoading) {
  <app-general-card [loading]="true">
    <div class="loading-skeleton">
      <div class="skeleton-header"></div>
      <div class="skeleton-stats">
        <div class="skeleton-stat"></div>
        <div class="skeleton-stat"></div>
        <div class="skeleton-stat"></div>
      </div>
    </div>
  </app-general-card>
} @else if (teamStats) {
  <app-general-card>
    <!-- Header Section -->
    @if (showHeader) {
      <div class="card-header">
        <div class="team-info">
          <a [routerLink]="['/app/team']" [queryParams]="{id: teamStats.team_id}" class="team-logo-link">
            <div class="team-logo-container">
              <img 
                [ngSrc]="images.getRouteImageTeam(teamStats.team_id)" 
                [alt]="teamStats.team_name"
                width="40" 
                height="40" 
                class="team-logo"
                priority="true">
            </div>
          </a>
          <div class="team-details">
            <div class="team-name-row">
              <a [routerLink]="['/app/team']" [queryParams]="{id: teamStats.team_id}" class="team-name-link">
                <h3 class="team-name">{{ teamStats.team_name }}</h3>
              </a>
              <div class="top-viewed-badge">
                <ng-icon name="jamTrophy" class="star-icon"></ng-icon>
                <span>Top Viewed</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    }

    <!-- Stats Grid -->
      <div class="stats-grid">
        <!-- Views -->
        <app-basic-stat-card
          label="Views"
          [value]="teamStats.views_count"
          icon="jamEyeF"
          iconClass="views">
        </app-basic-stat-card>

        <!-- Win Rate -->
        <app-basic-stat-card
          label="Win Rate"
          [value]="teamStats.win_rate"
          valueSuffix="%"
          icon="jamTarget"
          iconClass="win-rate">
        </app-basic-stat-card>

        <!-- Goals Scored -->
        <app-basic-stat-card
          label="Scored"
          [value]="teamStats.goals_scored"
          [subValue]="teamStats.matches_watched ? teamStats.goals_scored / teamStats.matches_watched : 0"
          icon="ionFootball"
          iconClass="goals-scored">
        </app-basic-stat-card>

        <!-- Goals Conceded -->
        <app-basic-stat-card
          label="Conceded"
          [value]="teamStats.goals_conceded"
          [subValue]="teamStats.matches_watched ? teamStats.goals_conceded / teamStats.matches_watched : 0"
          icon="ionFootball"
          iconClass="goals-conceded">
        </app-basic-stat-card>

      </div>

    <!-- Additional Stats -->
    <div class="additional-stats" [class.show-on-mobile]="showAllStatsOnMobile">
      <!-- Crazy Match -->
      @if (teamStats.crazy_match) {
        <app-mini-stat-card
          type="crazy-match"
          label="Crazy Match"
          [value]="teamStats.crazy_match.teams.home.name + ' ' + teamStats.crazy_match.goals.home + '-' + teamStats.crazy_match.goals.away + ' ' + teamStats.crazy_match.teams.away.name"
          [match_id]="teamStats.crazy_match.fixture?.id"
          [interactable]="interactable">
        </app-mini-stat-card>
      }

      <!-- Biggest Win -->
      @if (teamStats.biggest_win) {
        <app-mini-stat-card
          type="biggest-win"
          label="Biggest Win"
          [value]="teamStats.biggest_win.teams.home.name + ' ' + teamStats.biggest_win.goals.home + '-' + teamStats.biggest_win.goals.away + ' ' + teamStats.biggest_win.teams.away.name"
          [match_id]="teamStats.biggest_win.fixture?.id"
          [interactable]="interactable">
        </app-mini-stat-card>
      }

      <!-- Biggest Rival -->
      @if (teamStats.biggest_rival && teamStats.biggest_rival.matches_played > 1) {
        <app-mini-stat-card
          type="biggest-rival"
          label="Biggest Rival"
          [value]="teamStats.biggest_rival.team_name + ' - ' + teamStats.biggest_rival.matches_played + ' matches'"
          [team_id]="teamStats.biggest_rival.team_id"
          [interactable]="interactable">
        </app-mini-stat-card>
      }

      <!-- Most Viewed Location -->
      @if (teamStats.most_viewed_location) {
        <app-mini-stat-card
          type="most-viewed-location"
          label="Most Viewed Location"
          [value]="teamStats.most_viewed_location.location_name + ' - ' + teamStats.most_viewed_location.views_count + ' matches'"
          [interactable]="interactable">
        </app-mini-stat-card>
      }

      <!-- Home Stadium Times -->
      @if (teamStats.home_stadium_times) {
        <app-mini-stat-card
          type="home-stadium"
          label="Home Stadium"
          [value]="teamStats.home_stadium_times.location_name + ' - ' + teamStats.home_stadium_times.views_count + ' matches'"
          [interactable]="interactable">
        </app-mini-stat-card>
      }

      <!-- Total Away Stadium Visits -->
      @if (teamStats.total_away_stadium_visits !== undefined && teamStats.total_away_stadium_visits > 0) {
        <app-mini-stat-card
          type="total-away-visits"
          label="Away Stadium Support"
          [value]="teamStats.total_away_stadium_visits + ' stadium visits'"
          [interactable]="interactable">
        </app-mini-stat-card>
      }

      <!-- Away Stadium Support -->
      @if (teamStats.away_stadium_support && teamStats.away_stadium_support.views_count > 1) {
        <app-mini-stat-card
          type="away-support"
          label="Most Visited Away Stadium"
          [value]="teamStats.away_stadium_support.location_name + ' - ' + teamStats.away_stadium_support.views_count + ' matches'"
          [interactable]="interactable">
        </app-mini-stat-card>
      }

      <!-- Top Goalscorer -->
      @if (teamStats.top_goalscorer) {
        <app-mini-stat-card
          type="top-goalscorer"
          label="Top Goalscorer"
          [value]="teamStats.top_goalscorer.player_name + ' - ' + teamStats.top_goalscorer.goals + ' goals'"
          [subValue]="teamStats.top_goalscorer.goals + ' goals in ' + teamStats.top_goalscorer.matches + ' matches'"
          [player_id]="teamStats.top_goalscorer.player_id"
          [interactable]="interactable">
        </app-mini-stat-card>
      }

      <!-- Top Assist Provider -->
      @if (teamStats.top_assist_provider) {
        <app-mini-stat-card
          type="top-assist-provider"
          label="Top Assist Provider"
          [value]="teamStats.top_assist_provider.player_name + ' - ' + teamStats.top_assist_provider.assists + ' assists'"
          [subValue]="teamStats.top_assist_provider.assists + ' assists in ' + teamStats.top_assist_provider.matches + ' matches'"
          [player_id]="teamStats.top_assist_provider.player_id"
          [interactable]="interactable">
        </app-mini-stat-card>
      }

      <!-- Most Watched Player -->
      @if (teamStats.most_watched_player) {
        <app-mini-stat-card
          type="most-watched-player"
          label="Most Watched Player"
          [value]="teamStats.most_watched_player.player_name + ' - ' + teamStats.most_watched_player.matches + ' matches'"
          [subValue]="teamStats.most_watched_player.startXI_matches + ' starts'"
          [player_id]="teamStats.most_watched_player.player_id"
          [interactable]="interactable">
        </app-mini-stat-card>
      }
    </div>
  </app-general-card>
} @else {
  <app-general-card [empty]="true">
    <div class="empty-state">
      <ng-icon name="jamTrophy" class="empty-icon"></ng-icon>
      <h4>No Favourite Team</h4>
      <p>Set your favourite team to see personalized stats here</p>
      <button class="action-btn primary">
        <span>Set Favourite Team</span>
      </button>
    </div>
  </app-general-card>
} 