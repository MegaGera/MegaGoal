<div class="admin-feedback-container">
  <section class="fade-in">
    <div class="admin-header-row">
      <h1 class="section-title">User Feedback Administration</h1>
    </div>
    <p class="section-description">View and manage all user feedback submissions</p>

    @if (loading && feedbackList.length === 0) {
      <div class="text-center loading-container">
        <div class="spinner-border spinner-border-lg" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-3">Loading feedback...</p>
      </div>
    } @else if (error) {
      <div class="alert alert-danger" role="alert">
        {{ error }}
        <button class="btn btn-sm btn-outline-danger ms-2" (click)="loadFeedback()">Retry</button>
      </div>
    } @else if (feedbackList.length === 0) {
      <div class="empty-state">
        <p class="empty-message">No feedback submissions yet.</p>
      </div>
    } @else {
      <div class="feedback-stats">
        <div class="stat-card">
          <div class="stat-value">{{ totalSubmissions }}</div>
          <div class="stat-label">Total Submissions</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">{{ totalBugReports }}</div>
          <div class="stat-label">Bug Reports</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">{{ totalProposals }}</div>
          <div class="stat-label">Feature Proposals</div>
        </div>
      </div>

      <div class="feedback-list">
        @for (feedback of feedbackList; track feedback.id || feedback._id || $index) {
          @if (hasContent(feedback)) {
          <div class="feedback-card">
            <div class="feedback-header" (click)="toggleExpand(feedback)">
              <div class="feedback-user-info">
                <span class="username">{{ getUsername(feedback) }}</span>
                <span class="feedback-date">{{ formatDate(feedback.created_at) }}</span>
              </div>
              <div class="feedback-preview">
                <span class="preview-text">{{ getFeedbackPreview(feedback) }}</span>
                <button class="expand-button" [class.expanded]="isExpanded(feedback)">
                  <span class="expand-icon">‚ñº</span>
                </button>
              </div>
            </div>

            @if (isExpanded(feedback)) {
              <div class="feedback-content">
                @if (feedback.bug) {
                  <div class="feedback-section bug-section">
                    <h3 class="feedback-section-title">üêû Bug Report</h3>
                    <p class="feedback-text">{{ feedback.bug }}</p>
                  </div>
                }

                @if (feedback.voted_features && feedback.voted_features.length > 0) {
                  <div class="feedback-section voted-section">
                    <h3 class="feedback-section-title">üó≥Ô∏è Voted Features</h3>
                    <ul class="feature-list">
                      @for (feature of feedback.voted_features; track feature) {
                        <li class="feature-item">{{ feature }}</li>
                      }
                    </ul>
                  </div>
                }

                @if (feedback.proposal) {
                  <div class="feedback-section proposal-section">
                    <h3 class="feedback-section-title">üí° Feature Proposal</h3>
                    <p class="feedback-text">{{ feedback.proposal }}</p>
                  </div>
                }

                @if (feedback.general) {
                  <div class="feedback-section general-section">
                    <h3 class="feedback-section-title">üìù General Feedback</h3>
                    <p class="feedback-text">{{ feedback.general }}</p>
                  </div>
                }
              </div>
            }
          </div>
          }
        }
      </div>
    }
  </section>
</div>

