<div class="admin-players-container">
  <div class="header">
    <h2>Players Management</h2>
  </div>

  <!-- API Update Section -->
  <div class="update-section">
    <h3>Update Players from API</h3>
    <div class="update-controls">
      <div class="input-group">
        <label for="pageInput">Page Number:</label>
        <input 
          type="number" 
          id="pageInput" 
          [(ngModel)]="pageInput" 
          min="1" 
          placeholder="Enter page number"
          class="page-input"
        />
        <button 
          (click)="updatePlayers()" 
          [disabled]="isUpdatingPlayers"
          class="update-btn"
        >
          <ng-icon name="jamRefresh" [class.spinning]="isUpdatingPlayers"></ng-icon>
          {{ isUpdatingPlayers ? 'Updating...' : 'Update Players' }}
        </button>
      </div>
      
      <!-- Update Message -->
      <div *ngIf="updateMessage" class="update-message" [class.success]="updateSuccess" [class.error]="!updateSuccess">
        {{ updateMessage }}
      </div>

      <!-- API Info Display -->
      <div *ngIf="playersApiInfo" class="api-info">
        <h4>API Information</h4>
        <div class="info-grid">
          <div class="info-item">
            <span class="label">Total Pages:</span>
            <span class="value">{{ playersApiInfo.total_pages }}</span>
          </div>
          <div class="info-item">
            <span class="label">Pages Searched:</span>
            <span class="value">{{ playersApiInfo.pages_searched.length }}</span>
          </div>
          <div class="info-item">
            <span class="label">Last Update:</span>
            <span class="value">{{ playersApiInfo.last_update | date:'short' }}</span>
          </div>
        </div>
        <div *ngIf="playersApiInfo.pages_searched.length > 0" class="pages-list">
          <span class="label">Searched Pages:</span>
          <span class="pages">{{ playersApiInfo.pages_searched.join(', ') }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Players List Section -->
  <div class="players-section">
    <div class="section-header">
      <h3>Players in Database</h3>
      <div class="players-stats">
        <span>Showing: {{ players.length }} of {{ totalCount }}</span>
        <span *ngIf="searchText">Search: "{{ searchText }}"</span>
        <span>Page: {{ currentPage }} of {{ totalPages }}</span>
      </div>
    </div>

    <!-- Search Controls -->
    <div class="search-controls">
      <div class="search-filters">
        <!-- Name Search -->
        <div class="search-group">
          <ng-icon name="jamSearch" class="search-icon"></ng-icon>
          <input 
            type="text" 
            [(ngModel)]="searchText" 
            placeholder="Search players by name..."
            class="search-input"
            (keyup.enter)="searchPlayers()"
          />
        </div>

        <!-- Position Filter -->
        <div class="filter-group">
          <label class="filter-label">Position:</label>
          <select 
            [(ngModel)]="selectedPosition" 
            (change)="searchPlayers()"
            class="filter-select"
          >
            <option value="">All Positions</option>
            <option *ngFor="let position of availablePositions" [value]="position">
              {{ position }}
            </option>
          </select>
        </div>

        <!-- Nationality Filter -->
        <div class="filter-group">
          <label class="filter-label">Nationality:</label>
          <select 
            [(ngModel)]="selectedNationality" 
            (change)="searchPlayers()"
            class="filter-select"
          >
            <option value="">All Nationalities</option>
            <option *ngFor="let nationality of availableNationalities" [value]="nationality">
              {{ nationality }}
            </option>
          </select>
        </div>

        <!-- Teams Filter -->
        <div class="filter-group">
          <label class="filter-label">Teams:</label>
          <select 
            [(ngModel)]="selectedTeamsFilter" 
            (change)="searchPlayers()"
            class="filter-select"
          >
            <option value="">All Players</option>
            <option value="with-teams">With Teams</option>
            <option value="without-teams">Without Teams</option>
          </select>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button 
            (click)="searchPlayers()" 
            [disabled]="isSearching"
            class="search-btn"
          >
            <ng-icon name="jamSearch" [class.spinning]="isSearching"></ng-icon>
            {{ isSearching ? 'Searching...' : 'Search' }}
          </button>
          <button 
            *ngIf="searchText || selectedPosition || selectedNationality || selectedTeamsFilter" 
            (click)="clearSearch()" 
            class="clear-btn"
          >
            Clear
          </button>
        </div>
      </div>
    </div>

    <!-- Players Table -->
    <div class="players-table-container">
      <table class="players-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Photo</th>
            <th>Name</th>
            <th>Position</th>
            <th>Age</th>
            <th>Nationality</th>
            <th>Teams</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let player of getCurrentPagePlayers()" class="player-row">
            <td class="player-id">{{ player.player.id }}</td>
            <td class="player-photo">
              <img 
                [src]="player.player.photo" 
                [alt]="player.player.name"
                class="player-image"
                (error)="onImageError($event)"
              />
            </td>
            <td class="player-name">
              <div class="name-container">
                <div class="full-name">{{ player.player.name }}</div>
                <div *ngIf="player.player.firstname || player.player.lastname" class="name-parts">
                  <span *ngIf="player.player.firstname">{{ player.player.firstname }}</span>
                  <span *ngIf="player.player.lastname">{{ player.player.lastname }}</span>
                </div>
              </div>
            </td>
            <td class="player-position">
              <span *ngIf="player.player.position" class="position-badge">
                {{ player.player.position }}
              </span>
              <span *ngIf="!player.player.position" class="no-data">-</span>
            </td>
            <td class="player-age">
              <span *ngIf="player.player.age">{{ player.player.age }}</span>
              <span *ngIf="!player.player.age" class="no-data">-</span>
            </td>
            <td class="player-nationality">
              <span *ngIf="player.player.nationality">{{ player.player.nationality }}</span>
              <span *ngIf="!player.player.nationality" class="no-data">-</span>
            </td>
            <td class="player-teams">
              <span *ngIf="player.teams && player.teams.length > 0" class="teams-badge has-teams">
                <ng-icon name="jamCheck" class="icon"></ng-icon>
                {{ player.teams.length }} team{{ player.teams.length > 1 ? 's' : '' }}
              </span>
              <span *ngIf="!player.teams || player.teams.length === 0" class="teams-badge no-teams">
                <ng-icon name="jamClose" class="icon"></ng-icon>
                No teams
              </span>
            </td>
            <td class="player-actions">
              <button 
                (click)="updatePlayerTeams(player)" 
                [disabled]="isUpdatingTeams[player.player.id]"
                class="teams-btn"
                [class.loading]="isUpdatingTeams[player.player.id]"
              >
                <ng-icon 
                  *ngIf="!isUpdatingTeams[player.player.id]" 
                  name="jamRefresh" 
                  class="icon"
                ></ng-icon>
                <ng-icon 
                  *ngIf="isUpdatingTeams[player.player.id]" 
                  name="jamRefresh" 
                  class="icon spinning"
                ></ng-icon>
                {{ isUpdatingTeams[player.player.id] ? 'Updating...' : 'Update Teams' }}
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div *ngIf="totalPages > 1" class="pagination">
      <button 
        (click)="previousPage()" 
        [disabled]="!hasPrevPage"
        class="pagination-btn"
      >
        <ng-icon name="jamArrowLeft"></ng-icon>
        Previous
      </button>
      
      <div class="page-numbers">
        <button 
          *ngFor="let page of getPageNumbers()" 
          (click)="goToPage(page)"
          [class.active]="page === currentPage"
          class="page-btn"
        >
          {{ page }}
        </button>
      </div>
      
      <button 
        (click)="nextPage()" 
        [disabled]="!hasNextPage"
        class="pagination-btn"
      >
        Next
        <ng-icon name="jamArrowRight"></ng-icon>
      </button>
    </div>

    <!-- No Results Message -->
    <div *ngIf="players.length === 0" class="no-results">
      <ng-icon name="jamSearch" class="no-results-icon"></ng-icon>
      <p>No players found</p>
      <p *ngIf="searchText">Try adjusting your search terms</p>
    </div>
  </div>
</div>
