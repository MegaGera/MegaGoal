<div class="admin-container">
  <section class="fade-in">
    <div class="admin-header-row">
      <h1 class="section-title">Matches Administration</h1>
      <div class="toggle-selector">
        <div class="toggle-group">
          <button 
            class="toggle-button" 
            [class.active]="activeTab === 'landing'"
            (click)="setActiveTab('landing')">
            <span class="toggle-label">Landing Page</span>
            <span class="toggle-count">{{ markedLandingMatches.length }}</span>
          </button>
          <button 
            class="toggle-button" 
            [class.active]="activeTab === 'without-stats'"
            (click)="setActiveTab('without-stats')">
            <span class="toggle-label">Without Stats</span>
            <span class="toggle-count">{{ totalMatches }}</span>
          </button>
          <button 
            class="toggle-button" 
            [class.active]="activeTab === 'filters'"
            (click)="setActiveTab('filters')">
            <span class="toggle-label">Search & Filter</span>
            <span class="toggle-count">{{ filteredMatches.length }}</span>
          </button>
        </div>
      </div>
    </div>
    <p class="section-description">Manage and populate statistics for real matches</p>

    <!-- Tab Content -->
    <div class="tab-content">
      
      <!-- Landing Page Matches Tab -->
      @if (activeTab === 'landing') {
        <div class="priority-section">
          <h2 class="subsection-title">Landing Page Featured Matches</h2>
          <p class="subsection-description">Matches marked to appear on the landing page ({{ markedLandingMatches.length }} total, 3 shown randomly)</p>
          
          @if (loadingMarkedMatches) {
            <div class="text-center">
              <div class="spinner-border spinner-border-sm" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
            </div>
          } @else {
            <div class="matches-list priority-list">
              @for (m of markedLandingMatches; track m.fixture.id) {
                <app-admin-match-row
                  [match]="m"
                  [isMarkedForLanding]="true"
                  [isUpdating]="updatingFixtureId === m.fixture.id"
                  [isMarking]="markingFixtureId === m.fixture.id"
                  [showStatsBadge]="!isNotStarted(m)"
                  [showUpdateButton]="!isNotStarted(m)"
                  [showLandingButton]="true"
                  (updateStatistics)="updateStatistics($event)"
                  (toggleLanding)="toggleLandingMatch($event)">
                </app-admin-match-row>
              }
              @if (markedLandingMatches.length === 0) {
                <div class="text-center text-muted py-3">No matches marked for landing page</div>
              }
            </div>
          }
        </div>
      }

      <!-- Matches Without Statistics Tab -->
      @if (activeTab === 'without-stats') {
        <div class="priority-section">
          <h2 class="subsection-title">User Matches Without Statistics</h2>
          <p class="subsection-description">These are matches tracked by users that need statistics ({{ totalMatches }} total)</p>
          
          @if (loadingWithoutStats) {
            <div class="text-center">
              <div class="spinner-border spinner-border-sm" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
            </div>
          } @else {
            <div class="matches-list priority-list">
              @for (m of matchesWithoutStats; track m.fixture.id) {
                <app-admin-match-row
                  [match]="m"
                  [isMarkedForLanding]="isMarkedForLanding(m)"
                  [isUpdating]="updatingFixtureId === m.fixture.id"
                  [isMarking]="markingFixtureId === m.fixture.id"
                  [showStatsBadge]="!isNotStarted(m)"
                  [showUpdateButton]="!isNotStarted(m)"
                  [showLandingButton]="true"
                  (updateStatistics)="updateStatistics($event)"
                  (toggleLanding)="toggleLandingMatch($event)">
                </app-admin-match-row>
              }
              @if (matchesWithoutStats.length === 0) {
                <div class="text-center text-success py-3">âœ“ All user matches have statistics!</div>
              }
            </div>
            
            @if (totalPages > 1) {
              <div class="pagination-controls">
                <button class="btn btn-sm btn-outline-secondary" (click)="loadMatchesWithoutStatistics(currentPage - 1)" [disabled]="currentPage === 1">Previous</button>
                <span class="page-info">Page {{ currentPage }} of {{ totalPages }}</span>
                <button class="btn btn-sm btn-outline-secondary" (click)="loadMatchesWithoutStatistics(currentPage + 1)" [disabled]="currentPage === totalPages">Next</button>
              </div>
            }
          }
        </div>
      }

      <!-- Search & Filter Tab -->
      @if (activeTab === 'filters') {
        <div class="priority-section">
          <h2 class="subsection-title">Search & Filter Matches</h2>
          <p class="subsection-description">Filter matches by league, season, teams, and country</p>
          
          <div class="filters-row">
            <select class="form-select form-select-sm" [(ngModel)]="selectedLeague" (change)="onLeagueChange()">
              <option [ngValue]="null">All Leagues</option>
              @for (l of leagues; track l.league_id) {
                <option [ngValue]="l">{{ l.league_name }}</option>
              }
            </select>

            <select class="form-select form-select-sm" [(ngModel)]="selectedSeason" (change)="filterTeamsByLeagueAndSeason(); applyFilters()">
              <option [ngValue]="null">All Seasons</option>
              @for (s of seasons; track s.id) {
                <option [ngValue]="s">{{ s.text }}</option>
              }
            </select>

            <select class="form-select form-select-sm" [(ngModel)]="selectedCountry" (change)="applyFilters()">
              <option [ngValue]="null">All Countries</option>
              @for (c of countries; track c) {
                <option [ngValue]="c">{{ c }}</option>
              }
            </select>

            <select class="form-select form-select-sm" [(ngModel)]="selectedTeamId_1" (change)="applyFilters()">
              <option [ngValue]="null">All Teams</option>
              @for (t of filteredTeams; track t.id) {
                <option [ngValue]="t.id">{{ t.name }}</option>
              }
            </select>

            <select class="form-select form-select-sm" [(ngModel)]="selectedTeamId_2" [disabled]="!selectedTeamId_1" (change)="applyFilters()">
              <option [ngValue]="null">{{ selectedTeamId_1 ? 'Rival Team' : 'Select Team First' }}</option>
              @for (t of filteredTeams; track t.id) {
                <option [ngValue]="t.id">{{ t.name }}</option>
              }
            </select>

            <button class="btn btn-sm btn-outline-secondary" (click)="clearFilters()">Clear</button>
          </div>

          <!-- Toggle Filters -->
          <div class="toggle-filters-row mt-3">
            <div class="toggle-group">
              <button 
                class="toggle-button" 
                [class.active]="showOnlyFinished"
                (click)="showOnlyFinished = !showOnlyFinished; onToggleFilterChange()">
                <span class="toggle-label">Finished Only</span>
              </button>
              <button 
                class="toggle-button" 
                [class.active]="showOnlyWithoutStats"
                (click)="showOnlyWithoutStats = !showOnlyWithoutStats; onToggleFilterChange()">
                <span class="toggle-label">Without Stats</span>
              </button>
              <button 
                class="toggle-button" 
                [class.active]="sortByDateDesc"
                (click)="sortByDateDesc = !sortByDateDesc; onToggleFilterChange()">
                <span class="toggle-label">{{ sortByDateDesc ? 'Newest First' : 'Oldest First' }}</span>
              </button>
            </div>
          </div>

          @if (loading) {
            <div class="text-center mt-3">
              <div class="spinner-border spinner-border-sm" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
            </div>
          } @else {
            <div class="matches-list priority-list mt-3">
              @for (m of filteredMatches; track m.fixture.id) {
                <app-admin-match-row
                  [match]="m"
                  [isMarkedForLanding]="isMarkedForLanding(m)"
                  [isUpdating]="updatingFixtureId === m.fixture.id"
                  [isMarking]="markingFixtureId === m.fixture.id"
                  [showStatsBadge]="!isNotStarted(m)"
                  [showUpdateButton]="!isNotStarted(m)"
                  [showLandingButton]="true"
                  (updateStatistics)="updateStatistics($event)"
                  (toggleLanding)="toggleLandingMatch($event)">
                </app-admin-match-row>
              }
              @if (filteredMatches.length === 0) {
                <div class="text-center text-muted py-3">
                  {{ (selectedLeague || selectedSeason || selectedTeamId_1 || selectedCountry) ? 'No matches found' : 'Select at least 2 filters to search' }}
                </div>
              }
            </div>
          }
        </div>
      }
    </div>
  </section>
</div>
