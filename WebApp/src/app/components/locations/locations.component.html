<div class="container-fluid">
  <!-- Top Section - Location Management -->
  <div class="row mb-3">
    <div class="col-12">
      <div class="d-flex align-items-center gap-3">
        <div class="d-flex align-items-center gap-2">
          <label class="form-label mb-0">Location:</label>
          <select class="form-select form-select-sm" style="width: 200px;" [(ngModel)]="selectedLocation" (change)="onLocationChange()">
            <option [ngValue]="null">Select a location</option>
            @for (location of locations; track location.id) {
              <option [ngValue]="location">
                @if (location.stadium) {
                  üèüÔ∏è 
                }
                {{location.name}} ({{location.matchCount}})
              </option>
            }
          </select>
        </div>
        <button class="btn btn-sm btn-outline-primary" (click)="showAddLocationForm = !showAddLocationForm">
          + Add Location
        </button>
      </div>
      
      @if (showAddLocationForm) {
        <div class="mt-2">
          <form class="d-flex align-items-center gap-2" [formGroup]="newLocationForm" (ngSubmit)="addLocation()">
            <input
              type="text"
              class="form-control form-control-sm"
              placeholder="New location name"
              formControlName="name"
              style="width: 200px;"
            />
            <button class="btn btn-sm btn-primary" type="submit">Add</button>
            <button class="btn btn-sm btn-outline-secondary" type="button" (click)="showAddLocationForm = false">Cancel</button>
          </form>
        </div>
      }
    </div>
  </div>

  <div class="row">
    <!-- Left Column - Available Matches -->
    <div class="col-6">
      <div class="card">
        <div class="card-header">
          <h6 class="mb-0">Available Matches</h6>
        </div>
        <div class="card-body">
          <!-- Filters -->
          <div class="mb-3">
            <div class="d-flex align-items-center mb-2">
              <ng-icon name="jamFilter" class="me-2"></ng-icon>
              <strong>Filters:</strong>
              <button class="btn btn-sm btn-outline-secondary ms-auto" (click)="clearFilters()">Clear</button>
            </div>
            <div class="row g-2">
              <div class="col-6">
                <select class="form-select form-select-sm" [(ngModel)]="selectedLeague" (change)="applyFilters()">
                  <option [ngValue]="null">All Leagues</option>
                  @for (league of leagues; track league.league_id) {
                    <option [ngValue]="league">{{league.league_name}}</option>
                  }
                </select>
              </div>
                              <div class="col-6">
                  <select class="form-select form-select-sm" [(ngModel)]="selectedTeam_1" (change)="applyFilters()">
                    <option [ngValue]="null">All Teams</option>
                    @for (team of filteredTeams; track team.id) {
                      <option [ngValue]="team">{{team.name}}</option>
                    }
                  </select>
                </div>
              <div class="col-6">
                <select class="form-select form-select-sm" [(ngModel)]="selectedSeason" (change)="applyFilters()">
                  @for (season of seasons; track season.id) {
                    <option [ngValue]="season">{{season.text}}</option>
                  }
                </select>
              </div>
                              <div class="col-6">
                  <select class="form-select form-select-sm" [(ngModel)]="selectedTeam_2" (change)="applyFilters()">
                    <option [ngValue]="null">All Teams</option>
                    @for (team of filteredTeams; track team.id) {
                      <option [ngValue]="team">{{team.name}}</option>
                    }
                  </select>
                </div>
            </div>
          </div>

          <!-- Legend -->
          @if (filteredRealMatches.length > 0) {
            <div class="legend-container mb-3">
              <div class="legend-item">
                <div class="legend-color match-success"></div>
                <span class="legend-text">Matches viewed in this location</span>
              </div>
              <div class="legend-item">
                <div class="legend-color match-warning"></div>
                <span class="legend-text">Matches viewed in other location</span>
              </div>
            </div>
          }

          <!-- Available Matches List -->
          @if (loadingAvailableRealMatches) {
            <div class="text-center">
              <div class="spinner-border spinner-border-sm" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
            </div>
          } @else {
            <cdk-virtual-scroll-viewport itemSize="40" class="matches-container">
              @for (match of filteredRealMatches; track match.fixture.id) {
                <div class="match-row" 
                     [class.match-warning]="isMatchAlreadyViewed(match)" 
                     [class.match-success]="isMatchViewedAtSelectedLocation(match)"
                     [title]="getMatchLocationTooltip(match)">
                  <div class="stadium-column">
                    @if (isRealMatchViewedAtStadiumLocation(match)) {
                      <span class="stadium-badge">üèüÔ∏è</span>
                    }
                  </div>
                  <div class="match-content">
                    <img [src]="getTeamImageUrl(match.teams.home.id)" [alt]="match.teams.home.name" class="team-icon" loading="lazy">
                    <span class="team-name" [title]="match.teams.home.name">{{match.teams.home.name}}</span>
                    <span class="match-result">{{getMatchResult(match)}}</span>
                    <span class="team-name" [title]="match.teams.away.name">{{match.teams.away.name}}</span>
                    <img [src]="getTeamImageUrl(match.teams.away.id)" [alt]="match.teams.away.name" class="team-icon" loading="lazy">
                    <span class="league-info">{{match.league.name}}</span>
                    <span class="match-info">‚Ä¢ {{match.fixture.date | date:'dd/MM/yyyy'}}</span>
                  </div>
                  @if (match.fixture.venue.id) {
                    <button 
                        class="btn btn-sm btn-primary match-action venue-action" 
                        (click)="addMatchWithLocation(match, match.fixture.venue.id)"
                        title="Add to {{match.fixture.venue.name}}"
                        [disabled]="isRealMatchViewedAtStadiumLocation(match)"
                      >
                      üèüÔ∏è
                    </button>
                  }
                  @if (selectedLocation) {
                    <button 
                      class="btn btn-sm btn-success match-action" 
                      (click)="addMatchWithLocation(match, selectedLocation.id)"
                      title="Add to {{selectedLocation.name}}"
                      [disabled]="isMatchViewedAtSelectedLocation(match)"
                    >
                      <ng-icon name="jamPlus"></ng-icon>
                    </button>
                  }
                </div>
              }
              @if (filteredRealMatches.length === 0) {
                <div class="text-center text-muted py-3">
                  @if (getSelectedFilters().length < 2) {
                    Select more filters
                  } @else {
                    No matches available
                  }
                </div>
              }
            </cdk-virtual-scroll-viewport>
          }
        </div>
      </div>
    </div>

    <!-- Right Column - Viewed Matches -->
    <div class="col-6">
      <div class="card">
        <div class="card-header">
          <h6 class="mb-0">
            @if (selectedLocation) {
              Viewed Matches - {{selectedLocation.name}} ({{filteredViewedMatches.length}})
            } @else {
              Viewed Matches ({{filteredViewedMatches.length}})
            }
          </h6>
        </div>
        <div class="card-body">
          @if (loadingViewedMatches) {
            <div class="text-center">
              <div class="spinner-border spinner-border-sm" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
            </div>
          } @else {
            <cdk-virtual-scroll-viewport itemSize="40" class="matches-container-viewed">
              @for (match of filteredViewedMatches; track match._id) {
                <div class="match-row" [title]="getViewedMatchLocationTooltip(match)">
                  <div class="stadium-column">
                    @if (isMatchViewedAtStadiumLocation(match)) {
                      <span class="stadium-badge">üèüÔ∏è</span>
                    }
                  </div>
                  <div class="match-content">
                    <img [src]="getTeamImageUrl(match.teams.home.id)" [alt]="match.teams.home.name" class="team-icon" loading="lazy">
                    <span class="team-name" [title]="match.teams.home.name">{{match.teams.home.name}}</span>
                    <span class="match-result">{{getMatchResultFromMatch(match)}}</span>
                    <span class="team-name" [title]="match.teams.away.name">{{match.teams.away.name}}</span>
                    <img [src]="getTeamImageUrl(match.teams.away.id)" [alt]="match.teams.away.name" class="team-icon" loading="lazy">
                    <span class="league-info">{{match.league.name}}</span>
                    <span class="match-info">‚Ä¢ {{match.fixture.timestamp * 1000 | date:'dd/MM/yyyy'}}</span>                  
                  </div>
                  <button 
                    class="btn btn-sm btn-danger match-action" 
                    (click)="deleteMatch(match)"
                    title="Delete"
                  >
                    <ng-icon name="jamMinus"></ng-icon>
                  </button>
                </div>
              }
              @if (filteredViewedMatches.length === 0) {
                <div class="text-center text-muted py-3">
                  No matches viewed at this location
                </div>
              }
            </cdk-virtual-scroll-viewport>
          }
        </div>
      </div>
    </div>
  </div>
</div>